# HTTPS加密原理

## 加密原理
1. **client** 发送client-random随机密钥串与可用加密套件列表给 **serivce**
2. **service**发送service-random随机密钥串与加密套件以及自己的公钥给 **client**
3. **client**本地生成新的密钥 pre-master，然后用**service**返回的公钥信息对pre-master进行非对称加密之后将加密后的密钥发送给**service**, 由于是使用服务端给的公钥进行加密生成的，所以也只有服务端能对齐进行解密，其它第三方进行拦截了也解不开。
4. **service**用自己的私钥将其解开拿到pre-master。
5. 接下来**client**与**service**通过client-random + service-random + pre-master 生成密钥 master-secret，然后将master-secret作为密钥，采用对称加密对数据进行加密传输。


## 具体应用场景
1. 服务器并没有直接返回公钥给客户端，而是返回CA证书，公钥信息就在证书里面。
2. 客户端拿到证书之后，要先验证证书的有效性，然后再进行后续操作。


## CA数字证书
1. CA数字证书由CA机构颁发，证书上面包括网站的公钥，组织信息，有效时间，CA的信息等明文信息，然后还有一个由这些明文信息进行hash处理，再经过CA机构的私钥加密后生成的签名。
2. 浏览器拿到证书之后，将明文信息用相同的hash函数进行处理得到签名A，然后用CA机构的公钥对签名进行解密得到签名B。然后比较签名A与签名B是否相等来进行验证。
3. 当然，还得对CA机构进行验证，CA机构的验证是通过操作系统内置的可信任CA机构进行验证。